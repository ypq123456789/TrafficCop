# ç«¯å£æµé‡æ˜¾ç¤ºç²¾åº¦ä¿®å¤è¯´æ˜

## ğŸ› é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆï¼šTelegram æ¨é€çš„ç«¯å£æµé‡æ˜¾ç¤ºè¢«å–æ•´äº†ï¼Œåº”è¯¥ä¿ç•™ 2 ä½å°æ•°ï¼Œå’Œæ—¥å¿—è®°å½•çš„æ ¼å¼ä¸€è‡´ã€‚

**é—®é¢˜æˆªå›¾ï¼š**
```
ç«¯å£ 55549 (Port 55549)ï¼š0GB / 1000GB (0%)
ç«¯å£ 11710 (Port 11710)ï¼š0GB / 1000GB (0%)
```

**æœŸæœ›æ˜¾ç¤ºï¼š**
```
ç«¯å£ 55549 (Port 55549)ï¼š0.54GB / 1000GB (0.05%)
ç«¯å£ 11710 (Port 11710)ï¼š0.00GB / 1000GB (0.00%)
```

---

## ğŸ” æ ¹æœ¬åŸå› 

### é—®é¢˜åˆ†æ

1. **JSON æ•°æ®æœ¬èº«æ˜¯æ­£ç¡®çš„**
   - `view_port_traffic.sh` è¾“å‡ºçš„ JSON åŒ…å«å°æ•°
   - ä¾‹å¦‚ï¼š`{"port":55549,"usage":0.542,"limit":1000}`

2. **é€šçŸ¥è„šæœ¬æ˜¾ç¤ºæ—¶ä¸¢å¤±ç²¾åº¦**
   - ä» JSON æå–æ•°æ®åç›´æ¥æ‹¼æ¥å­—ç¬¦ä¸²
   - Bash å˜é‡åœ¨æŸäº›æƒ…å†µä¸‹ä¼šæˆªæ–­å°æ•°
   - æ²¡æœ‰ä½¿ç”¨ `printf` æ ¼å¼åŒ–è¾“å‡º

3. **ç™¾åˆ†æ¯”ç²¾åº¦ä¹Ÿä¸ä¸€è‡´**
   - åŸä»£ç ä½¿ç”¨ `scale=1`ï¼ˆä¿ç•™1ä½å°æ•°ï¼‰
   - åº”è¯¥ä½¿ç”¨ `scale=2`ï¼ˆä¿ç•™2ä½å°æ•°ï¼‰

### ä»£ç é—®é¢˜

**åŸä»£ç ï¼ˆæœ‰é—®é¢˜ï¼‰ï¼š**
```bash
local port_usage=$(echo "$port_data" | jq -r ".ports[$i].usage")
local port_limit=$(echo "$port_data" | jq -r ".ports[$i].limit")

# ç›´æ¥ä½¿ç”¨ï¼Œå¯èƒ½ä¸¢å¤±ç²¾åº¦
message="${message}...${port_usage}GB / ${port_limit}GB..."
```

**é—®é¢˜ï¼š**
- `port_usage` å¯èƒ½æ˜¯ `0.542`
- ç›´æ¥æ‹¼æ¥å¯èƒ½å˜æˆ `0GB` æˆ– `1GB`ï¼ˆå–æ•´ï¼‰
- ç™¾åˆ†æ¯” `scale=1` åªä¿ç•™1ä½å°æ•°

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤ç­–ç•¥

ä½¿ç”¨ `printf` æ ¼å¼åŒ–æ•°å­—è¾“å‡ºï¼Œç¡®ä¿ï¼š
1. æµé‡æ˜¾ç¤ºä¿ç•™ **2 ä½å°æ•°**
2. ç™¾åˆ†æ¯”æ˜¾ç¤ºä¿ç•™ **2 ä½å°æ•°**
3. ç»Ÿä¸€ä¸‰ä¸ªé€šçŸ¥ç³»ç»Ÿçš„æ˜¾ç¤ºæ ¼å¼

### ä¿®å¤ä»£ç 

#### Telegram é€šçŸ¥ (tg_notifier.sh)

**ä¿®æ”¹å‰ï¼š**
```bash
local port_usage=$(echo "$port_data" | jq -r ".ports[$i].usage")
local port_limit=$(echo "$port_data" | jq -r ".ports[$i].limit")

# è®¡ç®—ä½¿ç”¨ç™¾åˆ†æ¯”
local port_percentage=0
if [ -n "$port_limit" ] && [ "$port_limit" != "null" ] && (( $(echo "$port_limit > 0" | bc -l) )); then
    port_percentage=$(echo "scale=1; ($port_usage / $port_limit) * 100" | bc)
fi

message="${message}%0A${status_icon} ç«¯å£ ${port} (${port_desc})ï¼š${port_usage}GB / ${port_limit}GB (${port_percentage}%%)"
```

**ä¿®æ”¹åï¼š**
```bash
local port_usage=$(echo "$port_data" | jq -r ".ports[$i].usage")
local port_limit=$(echo "$port_data" | jq -r ".ports[$i].limit")

# æ ¼å¼åŒ–æµé‡æ˜¾ç¤ºï¼ˆä¿ç•™2ä½å°æ•°ï¼‰
local port_usage_formatted=$(printf "%.2f" "$port_usage" 2>/dev/null || echo "$port_usage")
local port_limit_formatted=$(printf "%.2f" "$port_limit" 2>/dev/null || echo "$port_limit")

# è®¡ç®—ä½¿ç”¨ç™¾åˆ†æ¯”ï¼ˆä¿ç•™2ä½å°æ•°ï¼‰
local port_percentage=0
if [ -n "$port_limit" ] && [ "$port_limit" != "null" ] && (( $(echo "$port_limit > 0" | bc -l) )); then
    port_percentage=$(printf "%.2f" $(echo "scale=2; ($port_usage / $port_limit) * 100" | bc))
fi

message="${message}%0A${status_icon} ç«¯å£ ${port} (${port_desc})ï¼š${port_usage_formatted}GB / ${port_limit_formatted}GB (${port_percentage}%%)"
```

**ä¼˜åŒ–ç‚¹ï¼š**
1. âœ… ä½¿ç”¨ `printf "%.2f"` æ ¼å¼åŒ–æµé‡ï¼ˆ2ä½å°æ•°ï¼‰
2. âœ… ç™¾åˆ†æ¯”ä» `scale=1` æ”¹ä¸º `scale=2`
3. âœ… ç™¾åˆ†æ¯”ä¹Ÿç”¨ `printf` æ ¼å¼åŒ–
4. âœ… æ·»åŠ é”™è¯¯å¤„ç†ï¼ˆ`2>/dev/null || echo "$port_usage"`ï¼‰

#### PushPlus é€šçŸ¥ (pushplus_notifier.sh)

**åŒæ ·çš„ä¿®å¤é€»è¾‘ï¼š**
```bash
# æ ¼å¼åŒ–æµé‡æ˜¾ç¤ºï¼ˆä¿ç•™2ä½å°æ•°ï¼‰
local port_usage_formatted=$(printf "%.2f" "$port_usage" 2>/dev/null || echo "$port_usage")
local port_limit_formatted=$(printf "%.2f" "$port_limit" 2>/dev/null || echo "$port_limit")

# è®¡ç®—ä½¿ç”¨ç™¾åˆ†æ¯”ï¼ˆä¿ç•™2ä½å°æ•°ï¼‰
port_percentage=$(printf "%.2f" $(echo "scale=2; ($port_usage / $port_limit) * 100" | bc))

content="${content}${status_icon} ç«¯å£ ${port} (${port_desc})ï¼š${port_usage_formatted}GB / ${port_limit_formatted}GB (${port_percentage}%)<br>"
```

#### Serveré…± é€šçŸ¥ (serverchan_notifier.sh)

**åŒæ ·çš„ä¿®å¤é€»è¾‘ï¼š**
```bash
# æ ¼å¼åŒ–æµé‡æ˜¾ç¤ºï¼ˆä¿ç•™2ä½å°æ•°ï¼‰
local port_usage_formatted=$(printf "%.2f" "$port_usage" 2>/dev/null || echo "$port_usage")
local port_limit_formatted=$(printf "%.2f" "$port_limit" 2>/dev/null || echo "$port_limit")

# è®¡ç®—ä½¿ç”¨ç™¾åˆ†æ¯”ï¼ˆä¿ç•™2ä½å°æ•°ï¼‰
port_percentage=$(printf "%.2f" $(echo "scale=2; ($port_usage / $port_limit) * 100" | bc))

desp="${desp}%0A| $port | $port_desc | ${port_usage_formatted}GB / ${port_limit_formatted}GB | ${port_percentage}%% | $status |"
```

---

## ğŸ“Š ä¿®å¤æ•ˆæœå¯¹æ¯”

### Telegram æ¶ˆæ¯

**ä¿®æ”¹å‰ï¼š**
```
ğŸ”Œ ç«¯å£æµé‡è¯¦æƒ…ï¼š
âœ… ç«¯å£ 55549 (Port 55549)ï¼š0GB / 1000GB (0%)
âœ… ç«¯å£ 11710 (Port 11710)ï¼š0GB / 1000GB (0%)
```

**ä¿®æ”¹åï¼š**
```
ğŸ”Œ ç«¯å£æµé‡è¯¦æƒ…ï¼š
âœ… ç«¯å£ 55549 (Port 55549)ï¼š0.54GB / 1000.00GB (0.05%)
âœ… ç«¯å£ 11710 (Port 11710)ï¼š0.00GB / 1000.00GB (0.00%)
```

### PushPlus æ¶ˆæ¯

**ä¿®æ”¹å‰ï¼š**
```html
ğŸ”Œ ç«¯å£æµé‡è¯¦æƒ…
âœ… ç«¯å£ 55549 (Port 55549)ï¼š0GB / 1000GB (0%)<br>
```

**ä¿®æ”¹åï¼š**
```html
ğŸ”Œ ç«¯å£æµé‡è¯¦æƒ…
âœ… ç«¯å£ 55549 (Port 55549)ï¼š0.54GB / 1000.00GB (0.05%)<br>
```

### Serveré…± æ¶ˆæ¯ï¼ˆMarkdownè¡¨æ ¼ï¼‰

**ä¿®æ”¹å‰ï¼š**
```
| ç«¯å£ | æè¿° | ä½¿ç”¨/é™åˆ¶ | ç™¾åˆ†æ¯” | çŠ¶æ€ |
|------|------|-----------|--------|------|
| 55549 | Port 55549 | 0GB / 1000GB | 0% | âœ… æ­£å¸¸ |
```

**ä¿®æ”¹åï¼š**
```
| ç«¯å£ | æè¿° | ä½¿ç”¨/é™åˆ¶ | ç™¾åˆ†æ¯” | çŠ¶æ€ |
|------|------|-----------|--------|------|
| 55549 | Port 55549 | 0.54GB / 1000.00GB | 0.05% | âœ… æ­£å¸¸ |
```

### æ—¥å¿—è®°å½•å¯¹æ¯”

**æ—¥å¿—æ ¼å¼ï¼ˆå·²ç»æ˜¯æ­£ç¡®çš„ï¼‰ï¼š**
```
2025-10-19 03:30:01 ç«¯å£ 55549: å…¥ç«™=0.32GB, å‡ºç«™=0.22GB, æ€»è®¡=0.54GB, å½“å‰=0.54GB, é™åˆ¶=1000GB (0.05%)
```

**ç°åœ¨é€šçŸ¥æ¶ˆæ¯å’Œæ—¥å¿—æ ¼å¼ä¸€è‡´äº†ï¼** âœ…

---

## ğŸš€ æ›´æ–°æ­¥éª¤

### åœ¨æœåŠ¡å™¨ä¸Šæ›´æ–°

```bash
# 1. æ›´æ–°ä¸‰ä¸ªé€šçŸ¥è„šæœ¬
cd /root/TrafficCop

wget -O tg_notifier.sh https://raw.githubusercontent.com/ypq123456789/TrafficCop/main/tg_notifier.sh
wget -O pushplus_notifier.sh https://raw.githubusercontent.com/ypq123456789/TrafficCop/main/pushplus_notifier.sh
wget -O serverchan_notifier.sh https://raw.githubusercontent.com/ypq123456789/TrafficCop/main/serverchan_notifier.sh

chmod +x tg_notifier.sh pushplus_notifier.sh serverchan_notifier.sh

# 2. æ‰‹åŠ¨æµ‹è¯•æ¯æ—¥æŠ¥å‘Š
bash /root/TrafficCop/tg_notifier.sh
# é€‰æ‹©ï¼š3) æ‰‹åŠ¨å‘é€æ¯æ—¥æŠ¥å‘Š

# 3. æŸ¥çœ‹æ¨é€çš„æ¶ˆæ¯ï¼ŒéªŒè¯æ ¼å¼
```

### é¢„æœŸæ•ˆæœ

å‘é€æµ‹è¯•æŠ¥å‘Šåï¼Œåº”è¯¥çœ‹åˆ°ï¼š

**Telegramï¼š**
```
ğŸ“Š [BWH THE PLAN V1]æ¯æ—¥æµé‡æŠ¥å‘Š

ğŸ–¥ï¸ æœºå™¨æ€»æµé‡ï¼š
å½“å‰ä½¿ç”¨ï¼š0.54GB
æµé‡é™åˆ¶ï¼š1000GB

ğŸ”Œ ç«¯å£æµé‡è¯¦æƒ…ï¼š
âœ… ç«¯å£ 55549 (Port 55549)ï¼š0.54GB / 1000.00GB (0.05%)
âœ… ç«¯å£ 11710 (Port 11710)ï¼š0.00GB / 1000.00GB (0.00%)
```

---

## ğŸ¯ æŠ€æœ¯ç»†èŠ‚

### printf æ ¼å¼åŒ–è¯´æ˜

```bash
# æ ¼å¼åŒ–ä¸º2ä½å°æ•°
printf "%.2f" 0.542
# è¾“å‡º: 0.54

printf "%.2f" 0.5
# è¾“å‡º: 0.50

printf "%.2f" 0
# è¾“å‡º: 0.00

printf "%.2f" 1000
# è¾“å‡º: 1000.00
```

### ä¸ºä»€ä¹ˆéœ€è¦ printfï¼Ÿ

**é—®é¢˜ç¤ºä¾‹ï¼š**
```bash
# ç›´æ¥ä½¿ç”¨å˜é‡ï¼ˆå¯èƒ½ä¸¢å¤±ç²¾åº¦ï¼‰
value=0.542
echo "$value GB"
# æŸäº›æƒ…å†µä¸‹å¯èƒ½è¾“å‡º: 0 GB æˆ– 1 GB

# ä½¿ç”¨ printfï¼ˆä¿è¯ç²¾åº¦ï¼‰
value=0.542
echo "$(printf "%.2f" $value) GB"
# è¾“å‡º: 0.54 GB
```

### bc ç²¾åº¦è®¾ç½®

**ä¿®æ”¹å‰ï¼š**
```bash
echo "scale=1; ($usage / $limit) * 100" | bc
# è¾“å‡º: 0.5  ï¼ˆ1ä½å°æ•°ï¼‰
```

**ä¿®æ”¹åï¼š**
```bash
printf "%.2f" $(echo "scale=2; ($usage / $limit) * 100" | bc)
# è¾“å‡º: 0.54  ï¼ˆ2ä½å°æ•°ï¼‰
```

---

## âœ… éªŒè¯æ¸…å•

æ›´æ–°åè¯·éªŒè¯ï¼š

- [ ] ç«¯å£æµé‡æ˜¾ç¤ºä¿ç•™ 2 ä½å°æ•°ï¼ˆä¾‹å¦‚ 0.54GBï¼‰
- [ ] æµé‡é™åˆ¶æ˜¾ç¤ºä¿ç•™ 2 ä½å°æ•°ï¼ˆä¾‹å¦‚ 1000.00GBï¼‰
- [ ] ä½¿ç”¨ç™¾åˆ†æ¯”ä¿ç•™ 2 ä½å°æ•°ï¼ˆä¾‹å¦‚ 0.05%ï¼‰
- [ ] å°æµé‡æ˜¾ç¤ºæ­£ç¡®ï¼ˆä¾‹å¦‚ 0.00GB è€Œä¸æ˜¯ 0GBï¼‰
- [ ] å¤§æµé‡æ˜¾ç¤ºæ­£ç¡®ï¼ˆä¾‹å¦‚ 42.35GBï¼‰
- [ ] Telegramã€PushPlusã€Serveré…±ä¸‰ä¸ªé€šçŸ¥æ ¼å¼ç»Ÿä¸€
- [ ] é€šçŸ¥æ¶ˆæ¯æ ¼å¼å’Œæ—¥å¿—æ ¼å¼ä¸€è‡´

---

## ğŸ” å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆ limit ä¹Ÿè¦æ ¼å¼åŒ–ï¼Ÿ

**åŸå› ï¼š** JSON ä¸­çš„ limit æ˜¯æ•´æ•°ï¼ˆä¾‹å¦‚ 1000ï¼‰ï¼Œä½†æ ¼å¼åŒ–åæ˜¾ç¤ºä¸º `1000.00GB`ï¼Œä¸ usage æ ¼å¼ä¿æŒä¸€è‡´ã€‚

**å¯¹æ¯”ï¼š**
```
ä¸ç»Ÿä¸€ï¼š0.54GB / 1000GB
ç»Ÿä¸€ï¼š  0.54GB / 1000.00GB  âœ…
```

---

### Q2: å¦‚æœ printf å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**å¤„ç†ï¼š** ä»£ç ä¸­ä½¿ç”¨äº†é™çº§å¤„ç†ï¼š
```bash
printf "%.2f" "$port_usage" 2>/dev/null || echo "$port_usage"
```

å¦‚æœ `printf` å¤±è´¥ï¼Œä¼šä½¿ç”¨åŸå§‹å€¼ã€‚

---

### Q3: ç™¾åˆ†æ¯”ä¸ºä»€ä¹ˆä¹Ÿæ”¹æˆ 2 ä½å°æ•°ï¼Ÿ

**åŸå› ï¼š** ç»Ÿä¸€ç²¾åº¦ï¼Œæ›´å‡†ç¡®ã€‚

**å¯¹æ¯”ï¼š**
```
1ä½å°æ•°ï¼š0.5%   ï¼ˆä¸å¤Ÿç²¾ç¡®ï¼‰
2ä½å°æ•°ï¼š0.54%  ï¼ˆæ›´ç²¾ç¡®ï¼‰
```

å¯¹äºå°æµé‡ï¼Œ2ä½å°æ•°æ›´èƒ½ä½“ç°å®é™…ä½¿ç”¨æƒ…å†µã€‚

---

## ğŸ‰ æ€»ç»“

**ä¿®å¤å†…å®¹ï¼š**
1. âœ… Telegram ç«¯å£æµé‡æ˜¾ç¤ºç²¾åº¦ä¿®å¤ï¼ˆ2ä½å°æ•°ï¼‰
2. âœ… PushPlus ç«¯å£æµé‡æ˜¾ç¤ºç²¾åº¦ä¿®å¤ï¼ˆ2ä½å°æ•°ï¼‰
3. âœ… Serveré…± ç«¯å£æµé‡æ˜¾ç¤ºç²¾åº¦ä¿®å¤ï¼ˆ2ä½å°æ•°ï¼‰
4. âœ… ç™¾åˆ†æ¯”è®¡ç®—ç²¾åº¦ç»Ÿä¸€ä¸º2ä½å°æ•°

**ä¿®æ”¹æ–‡ä»¶ï¼š**
- `tg_notifier.sh`
- `pushplus_notifier.sh`
- `serverchan_notifier.sh`

**å½±å“èŒƒå›´ï¼š**
- âœ… æ¯æ—¥æµé‡æŠ¥å‘Šæ¨é€
- âœ… ç«¯å£æµé‡è¯¦æƒ…æ˜¾ç¤º
- âšª ä¸å½±å“æµé‡ç›‘æ§å’Œé™åˆ¶åŠŸèƒ½

**æ¨é€çŠ¶æ€ï¼š** å¾…æ¨é€åˆ° GitHub

---

**æ–‡æ¡£æ›´æ–°æ—¶é—´ï¼š** 2025-10-19 03:30  
**ä¿®å¤ç‰ˆæœ¬ï¼š** é€šçŸ¥è„šæœ¬ç²¾åº¦ä¼˜åŒ–  
**çŠ¶æ€ï¼š** âœ… æœ¬åœ°ä¿®å¤å®Œæˆï¼Œå¾…æµ‹è¯•å¹¶æ¨é€
